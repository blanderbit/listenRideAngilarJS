<html>

<head>
    <title translate="shared.lnrHeaderText"></title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- served from cdn -->
    <script src="https://code.getmdl.io/1.3.0/material.min.js"></script>
    <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Roboto:300,400,500,700" type="text/css"></link>
    <link href="https://code.getmdl.io/1.2.1/material.blue_grey-blue.min.css" rel="stylesheet"></link>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.17.1/moment.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.4/lodash.min.js"></script>
    <script defer src="https://code.getmdl.io/1.3.0/material.min.js"></script>
    <!-- build:css lnr-shop-solution.min.css -->
    <link rel="stylesheet" href="lnr-shop-wizard.css"></link>
    <link rel="stylesheet" href="daterangepicker.css"></link>
    <!-- endbuild -->
    <!-- build:js lnr-shop-solution.min.js -->
    <script type="text/javascript" src="jquery.daterangepicker.js"></script>
    <script type="text/javascript" src="jquery.formatCurrency.min.js"></script>
    <script type="text/javascript" src="lnr-shop-wizard.translations.js"></script>
    <script type="text/javascript" src="lnr-shop-wizard.date.js"></script>
    <script type="text/javascript" src="lnr-shop-wizard.js"></script>
    <script type="text/javascript" src="lnr-shop-wizard.helper.js"></script>
    <script type="text/javascript" src="lnr-shop-wizard.validation.js"></script>
    <!-- endbuild -->
</head>

<body>
    <div class="mdl-layout mdl-js-layout mdl-layout--fixed-header">
        <!-- header -->
        <header class="mdl-layout__header" id="lnr-header">
            <div class="mdl-layout__header-row" id="lnr-header-logo">
                <img src="lnr_logo_bold.svg" width="95">
                <lnr-header-text translate="shared.lnrHeaderText"></lnr-header-text>
            </div>
        </header>
        <!-- wizard -->
        <main class="mdl-layout__content">
            <div class="page-content">
                <div class="mdl-tabs mdl-js-tabs">
                    <!-- tabs -->
                    <div class="mdl-tabs__tab-bar" id="lnr-tab-bar">
                        <a href="#duration-panel" class="mdl-tabs__tab is-active" id="tab-duration" translate="tabs.tabDuration"></a>
                        <a href="#basic-info-panel" class="mdl-tabs__tab" id="tab-basic-info" translate="tabs.tabBasicInfo"></a>
                        <a href="#payment-details-panel" class="mdl-tabs__tab" id="tab-payment-details" translate="tabs.tabPaymentDetail"></a>
                        <a href="#booking-overview-panel" class="mdl-tabs__tab" id="tab-booking-overview" translate="tabs.tabBookingOverview"></a>
                    </div>
                    <!-- duration tab -->
                    <div class="mdl-tabs__panel is-active" id="duration-panel">
                        <div class="mdl-grid lnr-row-top">
                            <div class="mdl-cell">
                                <p class="md-title-sm" translate="rental.title"></p>
                                <p class="md-subhead-sm" translate="rental.description"></p>
                            </div>
                        </div>
                        <div class="mdl-grid">
                            <!-- duration calendar -->
                            <div class="lnr-column-left mdl-cell mdl-cell--7-col mdl-cell--5-col-tablet mdl-cell--4-col-phone">
                                <!-- busy loader until calendar loads -->
                                <div id="bike-calendar-loader">
                                    <div class="mdl-spinner mdl-spinner--single-color mdl-js-spinner is-active"></div>
                                </div>
                                <!-- render the calendar here -->
                                <div id="bike-calendar"></div>
                                <!-- time range selection -->
                                <div class="mdl-grid" id="time-range">
                                    <div class="mdl-cell mdl-cell--6-col mdl-cell--4-col-tablet mdl-cell--2-col-phone dropdown-calendar">
                                    <label id="lnr-date-start" translate="durationPanel.from"></label>
                                        <button 
                                                type="button" 
                                                id="lnr-date-start-button" 
                                                onclick="helper.openCalendarDropDown('lnr-date-from-dropdown', '\'start\'')" 
                                                class="md-accent md-raised md-button md-ink-ripple lnr-back-button lnr-dropdown-button">
                                        </button>
                                        <div id="lnr-date-from-dropdown" class="dropdown-content" style="float: right"></div>
                                    </div>
                                    
                                    <div class="mdl-cell mdl-cell--6-col mdl-cell--4-col-tablet mdl-cell--2-col-phone dropdown-calendar">
                                        <label id="lnr-date-end" translate="durationPanel.to"></label>
                                        <button 
                                                type="button" 
                                                id="lnr-date-end-button" 
                                                onclick="helper.openCalendarDropDown('lnr-date-to-dropdown', '\'end\'')" 
                                                class="md-accent md-raised md-button md-ink-ripple lnr-back-button lnr-dropdown-button">
                                        </button>
                                        <div id="lnr-date-to-dropdown" class="dropdown-content"></div>
                                    </div>
                                </div>
                            </div>

                            <!-- rent info -->
                            <div class="lnr-column-right mdl-cell mdl-cell--5-col mdl-cell--3-col-tablet mdl-cell--4-col-phone">
                                <p class="md-title-sm" translate="rental.title"></p>
                                <p class="md-subhead-sm" translate="rental.description"></p>
                                <rental-info></rental-info>
                            </div>
                        </div>
                        <div class="mdl-grid lnr-row-bot">
                            <div class="mdl-cell">
                                <rental-info></rental-info>
                            </div>
                        </div>
                        <!-- nav buttons -->
                        <nav-buttons 
                                    current-tab="tab-duration"  
                                    back-tab="" 
                                    back-text="" 
                                    next-tab="'tab-basic-info'" 
                                    next-text="navigation.next">
                        </nav-buttons>
                    </div>
                    <!-- user info tab -->
                    <div class="mdl-tabs__panel" id="basic-info-panel">
                        <div class="mdl-grid lnr-row-top">
                            <div class="mdl-cell">
                               <div class="info-description">
                                    <p class="md-title-sm">
                                        <span class="info-title-empty" translate="info.titleEmpty"></span>
                                        <span class="info-title" translate="info.title"></span>
                                        <span class="first-name-text"></span>
                                    </p>
                                    <p class="md-subhead-sm" translate="info.description"></p>
                                    <p class="user-info-validation text-invalid" translate="info.invalidForm"></p>
                                </div>
                                <div class="info-error">
                                    <p class="text-invalid md-title-sm" translate="info.errorTitle"></p>
                                    <p class="text-invalid md-subhead-sm" translate="info.errorDescription"></p>
                                </div>
                            </div>
                        </div>
                        <div class="mdl-grid">
                            <!-- personal info form -->
                            <div class="lnr-column-left mdl-cell mdl-cell--7-col mdl-cell--5-col-tablet mdl-cell--4-col-phone">
                                <form id="user-info">
                                    <div class="lnr-input-containers" layout="row">
                                        <md-input-container flex class="mdl-textfield mdl-js-textfield">
                                            <label translate="info.firstName"></label>
                                            <input
                                                    id="form_first_name"
                                                    name="first_name"
                                                    class="md-input mdl-textfield__input"
                                                    pattern="^([\u00C0-\u017Fa-zA-Z '][\u00C0-\u017Fa-zA-Z- ' ]+[\u00C0-\u017Fa-zA-Z ']){1,20}$"
                                                    maxlength="30"
                                                    required
                                            >
                                        </md-input-container>
                                    </div>
                                    <div class="lnr-input-containers" layout="row">
                                        <md-input-container flex class="mdl-textfield mdl-js-textfield">
                                            <label translate="info.lastName"></label>
                                            <input
                                                    id="form_last_name"
                                                    name="last_name"
                                                    class="md-input mdl-textfield__input"
                                                    pattern="^([\u00C0-\u017Fa-zA-Z '][\u00C0-\u017Fa-zA-Z- ' ]+[\u00C0-\u017Fa-zA-Z ']){1,30}$"
                                                    maxlength="30"
                                                    required
                                            >
                                        </md-input-container>
                                    </div>
                                    <div class="lnr-input-containers" layout="row">
                                        <md-input-container class="mdl-textfield mdl-js-textfield">
                                            <label translate="info.email"></label>
                                            <input
                                                    id="form_email"
                                                    name="email"
                                                    class="md-input mdl-textfield__input"
                                                    type="email"
                                                    pattern="\S+@\S+"
                                                    required
                                            >
                                        </md-input-container>
                                    </div>
                                    <div class="lnr-input-containers" layout="row">
                                        <md-input-container class="mdl-textfield mdl-js-textfield">
                                            <label translate="info.emailRepeat"></label>
                                            <input
                                                    id="form_email_repeat"
                                                    name="email"
                                                    class="md-input mdl-textfield__input"
                                                    type="email"
                                                    pattern="\S+@\S+"
                                                    required
                                            >
                                        </md-input-container>
                                    </div>
                                </form>
                            </div>
                            <!-- rent info -->
                            <div class="lnr-column-right mdl-cell mdl-cell--5-col mdl-cell--3-col-tablet mdl-cell--4-col-phone">
                                <div class="info-description">
                                    <p class="md-title-sm">
                                        <span class="info-title-empty" translate="info.titleEmpty"></span>
                                        <span class="info-title" translate="info.title"></span>
                                        <span class="first-name-text"></span>
                                    </p>
                                    <p class="md-subhead-sm" translate="info.description"></p>
                                    <p class="user-info-validation text-invalid" translate="info.invalidForm"></p>
                                </div>
                                <div class="info-error">
                                    <p class="text-invalid md-title-sm" translate="info.errorTitle"></p>
                                    <p class="text-invalid md-subhead-sm" translate="info.errorDescription"></p>
                                </div>
                            </div>
                        </div>
                        <!-- nav buttons -->
                        <nav-buttons 
                                    current-tab="tab-basic-info" 
                                    back-tab="'tab-duration'" 
                                    back-text="navigation.back" 
                                    next-tab="'tab-payment-details'"
                                    next-text="navigation.next">
                        </nav-buttons>
                    </div>
                    <!-- payment tab -->
                    <div class="mdl-tabs__panel" id="payment-details-panel">
                        <div class="mdl-grid lnr-row-top">
                            <div class="mdl-cell">
                                <div class="payment-description">
                                    <p class="md-title-sm" translate="payment.title"></p>
                                    <p class="md-subhead-sm" translate="payment.description"></p>
                                    <p class="payment-info-validation text-invalid" translate="info.invalidForm"></p>
                                </div>
                                <div class="payment-error">
                                    <p class="text-invalid md-title-sm" translate="payment.titleError"></p>
                                    <p class="text-invalid md-subhead-sm" translate="payment.descriptionError"></p>
                                    <p class="payment-error-description text-invalid md-subhead-sm"></p>
                                </div>
                            </div>
                        </div>
                        <div class="mdl-grid">
                            <!-- payment info form -->
                            <div id="sp-payment" class="lnr-column-left mdl-cell mdl-cell--7-col mdl-cell--5-col-tablet mdl-cell--4-col-phone">
                                <div class="mdl-grid mdl-grid--buttons">
                                    <div class="mdl-cell mdl-cell--6-col mdl-cell--4-col-tablet mdl-cell--2-col-phone" style="margin: 0 10px 0 0">
                                        <button 
                                                type="button" 
                                                id="sp-button-paypal" 
                                                class="lnr-paypal md-accent md-raised md-button">
                                                <span translate="payment.payPal"></span>
                                        </button>
                                    </div>
                                    <div class="mdl-layout-spacer"></div>
                                    <div class="mdl-cell mdl-cell--6-col mdl-cell--4-col-tablet mdl-cell--2-col-phone" style="margin: 0 0 0 10px">
                                        <button 
                                                type="button" 
                                                class="lnr-mastercard md-accent md-raised md-button" 
                                                onclick="helper.showCreditCardForm()" 
                                                style="float: right">
                                                <span translate="payment.creditCard"></span>
                                        </button>
                                    </div>
                                </div>
                                <form id="sp-payment-form" style="margin: 20px 0">
                                    <div class="lnr-input-containers">
                                        <md-input-container class="mdl-textfield mdl-js-textfield">
                                            <label translate="payment.cardholderName"></label>
                                            <input
                                                    name="sp-payment-cardholder"
                                                    id="sp-payment-cardholder"
                                                    class="md-input mdl-textfield__input"
                                                    pattern="^([\u00C0-\u017Fa-zA-Z '][\u00C0-\u017Fa-zA-Z- ' ]+[\u00C0-\u017Fa-zA-Z ']){1,30}$"
                                                    maxlength="30"
                                                    required
                                            >
                                        </md-input-container>
                                    </div>
                                    <div class="lnr-input-containers">
                                        <md-input-container class="mdl-textfield mdl-js-textfield">
                                            <label translate="payment.cardNumber"></label>
                                            <input 
                                                 name="sp-payment-cardnumber" 
                                                 id="sp-payment-cardnumber"
                                                 class="md-input mdl-textfield__input"
                                                 pattern="^(?:4[0-9]{12}(?:[0-9]{3})?|5[1-5][0-9]{14}|6(?:011|5[0-9][0-9])[0-9]{12}|3[47][0-9]{13}|3(?:0[0-5]|[68][0-9])[0-9]{11}|(?:2131|1800|35\d{3})\d{11})$"
                                                 required
                                            >
                                        </md-input-container>
                                    </div>
                                    <div class="mdl-grid">
                                        <div class="mdl-cell mdl-cell--4-col mdl-cell--2-col-tablet mdl-cell--1-col-phone mdl-textfield mdl-js-textfield">
                                            <div class="dropdown-payment lnr-input-containers">
                                                <label translate="payment.expiry"></label>
                                                <button 
                                                        type="button" 
                                                        id="lnr-payment-date-button" 
                                                        onclick="helper.openExpirationDropdown('lnr-payment-date-dropdown', '\'date\'')"
                                                        class="md-accent md-raised md-button lnr-back-button lnr-dropdown-button">
                                                </button>
                                                <div id="lnr-payment-date-dropdown" class="dropdown-content"></div>
                                            </div>
                                        </div>
                                        <div class="mdl-layout-spacer"></div>
                                        <div class="mdl-cell mdl-cell--4-col mdl-cell--2-col-tablet mdl-cell--1-col-phone mdl-textfield mdl-js-textfield">
                                            <div class="dropdown-payment lnr-input-containers">
                                                <label>&nbsp;</label>
                                                <button 
                                                        type="button" 
                                                        id="lnr-payment-year-button" 
                                                        onclick="helper.openExpirationDropdown('lnr-payment-year-dropdown', '\'year\'')"
                                                        class="md-accent md-raised md-button md-ink-ripple lnr-back-button lnr-dropdown-button">To
                                                </button>
                                                <div id="lnr-payment-year-dropdown" class="dropdown-content">
                                                </div>
                                            </div>
                                        </div>
                                        <div class="mdl-layout-spacer"></div>
                                        <div class="mdl-cell mdl-cell--4-col mdl-cell--2-col-tablet mdl-cell--1-col-phone">
                                            <div class="lnr-input-containers">
                                                <md-input-container class="mdl-textfield mdl-js-textfield">
                                                    <label translate="payment.CVV"></label>
                                                    <input
                                                            name="sp-payment-cvv"
                                                            id="sp-payment-cvv"
                                                            placeholder="123"
                                                            class="md-input mdl-textfield__input"
                                                            pattern="^[0-9]{3,4}$"
                                                            required
                                                    >
                                                </md-input-container>
                                            </div>
                                        </div>
                                    </div>
                                </form>
                            </div>
                            <!-- rent info -->
                            <div class="lnr-column-right mdl-cell mdl-cell--5-col mdl-cell--3-col-tablet mdl-cell--4-col-phone">
                                <div class="payment-description">
                                    <p class="md-title-sm" translate="payment.title"></p>
                                    <p class="md-subhead-sm" translate="payment.description"></p>
                                    <p class="payment-info-validation text-invalid" translate="info.invalidForm"></p>
                                </div>
                                <div class="payment-error">
                                    <p class="text-invalid md-title-sm" translate="payment.titleError"></p>
                                    <p class="text-invalid md-subhead-sm" translate="payment.descriptionError"></p>
                                    <p class="payment-error-description text-invalid md-subhead-sm"></p>
                                </div>
                            </div>
                        </div>
                        <!-- nav buttons -->
                        <nav-buttons  
                                    current-tab="tab-payment-details" 
                                    back-tab="'tab-basic-info'" 
                                    back-text="navigation.back" 
                                    next-tab="'tab-booking-overview'"
                                    next-text="navigation.next">
                        </nav-buttons>
                    </div>
                    <!-- booking overview tab -->
                    <div class="mdl-tabs__panel" id="booking-overview-panel">
                        <div class="mdl-grid lnr-row-top">
                            <div class="mdl-cell">
                                <div class="overview-description">
                                    <p class="md-title-sm" translate="overview.title"></p>
                                    <p class="md-subhead-sm" translate="overview.description"></p>
                                </div>
                                <div class="overview-error">
                                    <p class="text-invalid md-title-sm" translate="overview.errorTitle"></p>
                                    <p class="text-invalid md-subhead-sm" translate="overview.errorDescription"></p>
                                    <p class="overview-error-description text-invalid md-subhead-sm"></p>
                                </div>
                                <div class="overview-success">
                                    <p class="text-valid md-title-sm" translate="overview.titleSuccess"></p>
                                    <p class="text-valid md-subhead-sm" translate="overview.descriptionSuccess"></p>
                                </div>
                            </div>
                        </div>
                        <div class="mdl-grid">
                            <!-- overview info -->
                            <div class="lnr-column-left mdl-cell mdl-cell--7-col mdl-cell--5-col-tablet mdl-cell--4-col-phone">
                                <img id="bike_picture" style="width: 100%">
                                <ul class="lnr-list-sm mdl-list">
                                    <li class="mdl-list__item">
                                        <span style="flex: 50;" class="md-title-sm mdl-list__item-primary-content">Bike</span>
                                        <span id="overview_bike" class="md-subhead-sm mdl-list__item-primary-content"></span>
                                    </li>
                                    <li class="mdl-list__item">
                                        <span style="flex: 50;" class="md-title-sm mdl-list__item-primary-content">Name</span>
                                        <span id="overview_name" class="md-subhead-sm mdl-list__item-primary-content"></span>
                                    </li>
                                    <li class="mdl-list__item">
                                        <span style="flex: 50;" class="md-title-sm mdl-list__item-primary-content">Lister</span>
                                        <span id="overview_lister" class="md-subhead-sm mdl-list__item-primary-content text-right"></span>
                                    </li>
                                    <li class="mdl-list__item">
                                        <span style="flex: 50;" class="md-title-sm mdl-list__item-primary-content">Location</span>
                                        <span id="overview_location" class="md-subhead-sm mdl-list__item-primary-content"></span>
                                    </li>
                                </ul>
                            </div>
                            <!-- rent info -->
                            <div class="lnr-column-right mdl-cell mdl-cell--5-col mdl-cell--3-col-tablet mdl-cell--4-col-phone">
                                <div class="overview-description">
                                    <p class="md-title-sm" translate="overview.title"></p>
                                    <p class="md-subhead-sm" translate="overview.description"></p>
                                </div>
                                <div class="overview-error">
                                    <p class="text-invalid md-title-sm" translate="overview.errorTitle"></p>
                                    <p class="text-invalid md-subhead-sm" translate="overview.errorDescription"></p>
                                    <p class="overview-error-description text-invalid md-subhead-sm"></p>
                                </div>
                                <div class="overview-success">
                                    <p class="text-valid md-title-sm" translate="overview.titleSuccess"></p>
                                    <p class="text-valid md-subhead-sm" translate="overview.descriptionSuccess"></p>
                                </div>
                                <rental-info></rental-info>
                            </div>
                        </div>
                        <div class="mdl-grid lnr-row-bot">
                            <div class="mdl-cell">
                                <rental-info></rental-info>
                            </div>
                        </div>
                        <!-- nav buttons -->
                        <nav-buttons 
                                    current-tab="tab-booking-overview" 
                                    back-tab="'tab-payment-details'" 
                                    back-text="navigation.back" 
                                    next-tab="'tab-duration'" 
                                    next-text="navigation.book">
                        </nav-buttons>
                    </div>
                </div>
            </div>
        </main>
    </div>
    <!-- Loading Braintree -->
    <script src="https://js.braintreegateway.com/web/3.11.0/js/client.min.js"></script>
    <script src="https://js.braintreegateway.com/web/3.11.0/js/paypal.min.js"></script>
    <script src="https://js.braintreegateway.com/web/3.11.0/js/data-collector.min.js"></script>
    <script>
        // We generated a client token for you so you can test out this code
        // immediately. In a production-ready integration, you will need to
        // generate a client token on your server (see section below).
        var authorization =
            'eyJ2ZXJzaW9uIjoyLCJhdXRob3JpemF0aW9uRmluZ2VycHJpbnQiOiIzYWNlYjVkOGFjMzczNzkyNmQ5YmUxOTY3ZjE1NGVjOGQ2OTZhYWU2YmJmZDJmMWZjZWI5MTU2ZTYwYTZiOTk1fGNyZWF0ZWRfYXQ9MjAxNy0wMy0xOFQyMjowMTo1MS4wOTIzMTcxMDYrMDAwMFx1MDAyNm1lcmNoYW50X2lkPXQ0cHRuNTRtc3d4bXBuZDVcdTAwMjZwdWJsaWNfa2V5PXY5d203eXR6anhzcDg5a3EiLCJjb25maWdVcmwiOiJodHRwczovL2FwaS5zYW5kYm94LmJyYWludHJlZWdhdGV3YXkuY29tOjQ0My9tZXJjaGFudHMvdDRwdG41NG1zd3htcG5kNS9jbGllbnRfYXBpL3YxL2NvbmZpZ3VyYXRpb24iLCJjaGFsbGVuZ2VzIjpbImN2diJdLCJlbnZpcm9ubWVudCI6InNhbmRib3giLCJjbGllbnRBcGlVcmwiOiJodHRwczovL2FwaS5zYW5kYm94LmJyYWludHJlZWdhdGV3YXkuY29tOjQ0My9tZXJjaGFudHMvdDRwdG41NG1zd3htcG5kNS9jbGllbnRfYXBpIiwiYXNzZXRzVXJsIjoiaHR0cHM6Ly9hc3NldHMuYnJhaW50cmVlZ2F0ZXdheS5jb20iLCJhdXRoVXJsIjoiaHR0cHM6Ly9hdXRoLnZlbm1vLnNhbmRib3guYnJhaW50cmVlZ2F0ZXdheS5jb20iLCJhbmFseXRpY3MiOnsidXJsIjoiaHR0cHM6Ly9jbGllbnQtYW5hbHl0aWNzLnNhbmRib3guYnJhaW50cmVlZ2F0ZXdheS5jb20vdDRwdG41NG1zd3htcG5kNSJ9LCJ0aHJlZURTZWN1cmVFbmFibGVkIjp0cnVlLCJwYXlwYWxFbmFibGVkIjp0cnVlLCJwYXlwYWwiOnsiZGlzcGxheU5hbWUiOiJMaXN0IG4gUmlkZSIsImNsaWVudElkIjpudWxsLCJwcml2YWN5VXJsIjoiaHR0cDovL2V4YW1wbGUuY29tL3BwIiwidXNlckFncmVlbWVudFVybCI6Imh0dHA6Ly9leGFtcGxlLmNvbS90b3MiLCJiYXNlVXJsIjoiaHR0cHM6Ly9hc3NldHMuYnJhaW50cmVlZ2F0ZXdheS5jb20iLCJhc3NldHNVcmwiOiJodHRwczovL2NoZWNrb3V0LnBheXBhbC5jb20iLCJkaXJlY3RCYXNlVXJsIjpudWxsLCJhbGxvd0h0dHAiOnRydWUsImVudmlyb25tZW50Tm9OZXR3b3JrIjp0cnVlLCJlbnZpcm9ubWVudCI6Im9mZmxpbmUiLCJ1bnZldHRlZE1lcmNoYW50IjpmYWxzZSwiYnJhaW50cmVlQ2xpZW50SWQiOiJtYXN0ZXJjbGllbnQzIiwiYmlsbGluZ0FncmVlbWVudHNFbmFibGVkIjpmYWxzZSwibWVyY2hhbnRBY2NvdW50SWQiOiJjano5cTV0Zjk0cHdkM2Y5IiwiY3VycmVuY3lJc29Db2RlIjoiVVNEIn0sImNvaW5iYXNlRW5hYmxlZCI6ZmFsc2UsIm1lcmNoYW50SWQiOiJ0NHB0bjU0bXN3eG1wbmQ1IiwidmVubW8iOiJvZmYifQ==';

        var deviceData;

        braintree.client.create({
            authorization: authorization
        }, function (clientErr, clientInstance) {
            if (clientErr) {
                // Handle error in client creation
                return;
            }

            braintree.dataCollector.create({
                client: clientInstance,
                kount: true
            }, function (err, dataCollectorInstance) {
                if (err) {
                    // Handle error in creation of data collector
                    return;
                }
                // At this point, you should access the dataCollectorInstance.deviceData value and provide it
                // to your server, e.g. by injecting it into your form as a hidden input.
                deviceData = dataCollectorInstance.deviceData;
            });

            $('#lnr-next-button-tab-payment-details')[0].addEventListener('click', function () {
                var form = document.getElementById('sp-payment-form')
                var data = {
                    creditCard: {
                        number: form['sp-payment-cardnumber'].value,
                        cvv: form['sp-payment-cvv'].value,
                        expirationDate: payment.date+"/"+payment.year,
                        options: {
                            validate: false
                        }
                    }
                };
                clientInstance.request({
                    endpoint: 'payment_methods/credit_cards',
                    method: 'post',
                    data: data
                }, function (requestErr, response) {
                    // More detailed example of handling API errors: https://codepen.io/braintree/pen/MbwjdM
                    if (requestErr) {
                        throw new Error(requestErr);
                    }
                    // Received Payment Nonce by Braintree, now try to send it to the backend
                    $.post(
                        apiUrl + "/users/"+user.id+"/payment_methods",
                        {
                            "payment_method_nonce": response.creditCards[0].nonce,
                            "device_data": deviceData
                        }
                    ).done(function (data) {
                        $('.payment-error').hide();
                        $('.payment-description').show();
                        helper.changeTab({id: 'tab-booking-overview'});
                    }).fail(function(data) {
                        $('.payment-description').hide();
                        $('.payment-error-description').text(data.responseJSON.errors[0].detail);
                        $('.payment-error').show();
                    });
                });
            });

            braintree.paypal.create({
                    client: clientInstance
                },
                function (createErr, paypalInstance) {
                    if (createErr) {
                        if (createErr.code === 'PAYPAL_BROWSER_NOT_SUPPORTED') {
                            console.error('This browser is not supported.');
                        } else {
                            console.error('Error!', createErr);
                        }
                    }
                    $("#sp-button-paypal")[0].addEventListener('click', function () {
                        // Disable the button so that we don't attempt to open multiple popups.
                        $("#sp-button-paypal")[0].setAttribute('disabled', 'disabled');
                        $('#sp-payment-form').hide();

                        // Because PayPal tokenization opens a popup, this must be called
                        // as a result of a user action, such as a button click.
                        paypalInstance.tokenize({
                                flow: 'vault' // Required
                                // Any other tokenization options
                            },
                            function (tokenizeErr, payload) {
                                $("#sp-button-paypal")[0].removeAttribute('disabled');
                                if (tokenizeErr) {
                                    // Handle tokenization errors or premature flow closure
                                    switch (tokenizeErr.code) {
                                        case 'PAYPAL_POPUP_CLOSED':
                                            console.error('Customer closed PayPal popup.');
                                            break;
                                        case 'PAYPAL_ACCOUNT_TOKENIZATION_FAILED':
                                            console.error(
                                                'PayPal tokenization failed. See details:',
                                                tokenizeErr.details);
                                            break;
                                        case 'PAYPAL_FLOW_FAILED':
                                            console.error(
                                                'Unable to initialize PayPal flow. Are your options correct?',
                                                tokenizeErr.details);
                                            break;
                                        default:
                                            console.error('Error!', tokenizeErr);
                                    }
                                } else {
                                    $.post(
                                        apiUrl + "/users/"+user.id+"/payment_methods",
                                        {
                                            "payment_method_nonce": payload.nonce,
                                            "device_data": deviceData
                                        }
                                    ).done(function (data) {
                                        $('.payment-error').hide();
                                        $('.payment-description').show();
                                        helper.changeTab({id: 'tab-booking-overview'});
                                    }).fail(function(data) {
                                        $('.payment-description').hide();
                                        $('.payment-error-description').text(data.responseJSON.errors[0].detail);
                                        $('.payment-error').show();
                                    });
                                }
                            });
                    });
                });
        });
    </script>
</body>

</html>
